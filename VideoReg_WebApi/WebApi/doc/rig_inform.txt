
Получение изображений с камеры
Сценарий получения изображений без конвертации

--> REQ

GET /Camera/GetImage?camera=1 HTTP/1.1
Host: 127.0.0.1:7000

<-- res

HTTP/1.1 200 OK
Date: Fri, 01 May 2020 08:35:27 GMT
Content-Type: image/jpeg
Content-Length: 254896
X-TIMESTAMP: 2020-05-01T13:35:24.899

     JFIF  ` `     C     

параметры 
	camera - число от 1 до 9
	width - число от -1 до 1024
	height - число от -1 до 768
	quality- число от -1 до 100

настройки=width+height+quality 

 настройки с 0 - вернет непережатое изображение с камеры
 настройки больше 0 - вернет пережатое изображение с камеры. также включится фоновое пережимка изображений ля переданной камеры что замедлит максимально возможный fps но может уменьшить объем передаваемого трафика.
 настройки с -1 - вернет непережатое изображение с камеры. Также отключит фоновое пережатие изображения.
 ! Переключение настроек сжатия занимает требует дополнительных ресурсов. Не меняйте настройки часто.

.....................................................
 
Сервер вернет изображения. Необходимо считать Header X-TIMESTAMP. 
И использовать при следующем запросе добавить в Header X-TIMESTAMP
! Сервер в фоновом режимеме берет снапшоты с камер и конвертирует их с случаии необходимости
 Клиент при обращении сразу получает изображение. Но если оно не успело обновится сервер придержит запрос
 пока не обновится изобращение либо не пройдет таймат ожидания. Это позволяет клиенту с наибыстрейшей скоростью
 получать недублирующиеся иображения.
 

Это метка позволит серверу вернуть в следующий раз изображение если оно изменилось. 
А если нет попробывать дождатся пока оно изменится.

/// <summary>
/// Получить изображение по камере.
/// Если не пепредавать настройки (или передать любую по умолчанию значение 0) то будет отдано оригинальное изображение.
/// Если передать настройки хоть одну из настроек передать -1 то конвертация отключится.
/// !Конвертация изображений позволяет уменьшить обьем передаваемого трафика но занимает много времени.
/// Выставлять высокие настройки конвертации не имеет смысла так как изображение лучше исходного не станет
/// Но увеличится в размерах и долго будет конвертироватся. Что значительно уменьшит fps.
/// Пережимать изображения стоит только если канал связи плохой и выставлять низкие настройки. 
/// Также в тело http запроса следует добавлять заголовок "X-TIMESTAMP" в формате yyyy-MM-ddTHH:mm:ss.fff
/// Каждому кадру взятому с камеры присваевается временная метка
/// Это позволит не отдавать кадр пока не изменится эта временная метка тоесть кадр.
/// Также этот же заголовок будет установлен в ответе. И его следует использовать при следующем запросе чтобы получить измененное изображение а не копию предыдущего.
/// </summary>
/// <param name="camera">Номер камеры от 1-9</param>
/// <param name="settings">Настройки камеры</param>
/// <response code="200">Изображение с камеры</response>
/// <response code="404">Переданная камера не найдена</response>
/// <response code="400">Неверные параметры запроса</response>
/// <response code="304">Изображение с камеры не изменялось</response>


Запрос структуры архива
GET /VideoArchive/Structure HTTP/1.1
Host: 127.0.0.1:7000

В ответ придет

[
    {
        "camera": 1,
        "brigade": -1,
        "pdt": "2018-07-16T01:00:00",
        "duration": 60
    },
    {
        "camera": 1,
        "brigade": -1,
        "pdt": "2018-07-16T01:01:00",
        "duration": 60
    }
]

Видео файлы пишутся раз в минуты. Поэтому спрашивать структуру архива следует раз в 70 секунд. 
Чтобы не передавать лишнюю информации

В селдующем запросе следует добавить параметер startWith указав в нем дату. В результате вернутся структура с большими либо разныии по дате файлами.
GET /VideoArchive/Structure?startWith=2018-05-18T01:22:10 HTTP/1.1
Host: 127.0.0.1:7000


Пример запроса архива

GET /VideoArchive/File?camera=1&pdt=2018-07-16T01:01:00 HTTP/1.1
Host: 127.0.0.1:7000
Range: bytes=15-20

В заголовках будет ключ X-BRIGADE это код под которым работала бригада когда писался файл 
Если код не был указан будет значение -1. Также иногда они вводят коды бригады неверно. Так что это не гарантированно точная информация.


Запрос информации о регистраторе
GET /VideoReg/Info HTTP/1.1
Host: 127.0.0.1:7000

{
    "brigadeCode": 1,
    "ip": "100.11.11.11",
    "vpn": "10.36.0.1"
}

Пока из полезной сдесь только текущий код бригады. Потом возможно чтонибудь добавится